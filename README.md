# SnowFormer: Context Interaction Transformer with Scale-awareness for Single Image Desnowing
**<font size=5>Authors:</font>** [Sixiang Chen](https://scholar.google.com/citations?hl=zh-CN&user=EtljKSgAAAAJ), [Tian Ye](https://scholar.google.com/citations?user=1sGXZ-wAAAAJ&hl=zh-CN), [Yun Liu](http://ai.swu.edu.cn/info/1071/1804.htm), [Erkang Chen](https://scholar.google.com/citations?user=hWo1RTsAAAAJ&hl=zh-CN)

[SnowFormer: Context Interaction Transformer with Scale-awareness for Single Image Desnowing](https://arxiv.org/abs/2208.09703)

> **Abstract:** *Due to various and complicated snow degradations, single image desnowing is a challenging image restoration task. As prior arts can not handle it ideally, we propose a novel transformer, SnowFormer, which explores efficient cross-attentions to build local-global context interaction across patches and surpasses existing works that employ local operators or vanilla transformers. Compared to prior desnowing methods and universal image restoration methods, SnowFormer has several benefits. Firstly, unlike the multi-head self-attention in recent image restoration Vision Transformers, SnowFormer incorporates the multi-head cross-attention mechanism to perform local-global context interaction between scale-aware snow queries and local-patch embeddings. Second, the snow queries in SnowFormer are generated by the query generator from aggregated scale-aware features, which are rich in potential clean cues, leading to superior restoration results. Third, SnowFormer outshines advanced state-of-the-art desnowing networks and the prevalent universal image restoration transformers on six synthetic and real-world datasets.*



##
<table>
  <tr>
    <td><p align='center'>
    <img src="https://github.com/Ephemeral182/SnowFormer/blob/master/image/SnowFormer1_1.jpg#pic_center" width="80%" ></img></td>
  </tr>
  <tr>
    <td><p align="center"><b>Overall Framework of SnowFormer</b></p></td>
  </tr> 
</table>

<table>
  <tr>
    <td> <img src = "https://github.com/Ephemeral182/SnowFormer/blob/master/image/PSNR_param.png" width="450"> </td>
    <td> <img src = "https://github.com/Ephemeral182/SnowFormer/blob/master/image/PSNR_param_srrs.png" width="450"> </td>
  </tr>
  <tr>
    <td><p align="center"><b>PSNR v.s. Parameters on CSD Dataset</b></p></td>
    <td><p align="center"> <b>PSNR v.s. Parameters on SRRS Dataset</b></p></td>
  </tr>
</table>

<table>
  <tr>
    <td><p align='center'>
    <img src="https://github.com/Ephemeral182/SnowFormer/blob/master/image/result.png#pic_center" width="900" ></img></td>
  </tr>
  <tr>
    <td><p align="center"><b>Results on CSD, SRRS, Snow100K datasets</b></p></td>
  </tr> 
</table>

## Installation
Our SnowFormer is built in Pytorch1.12.0, we train and test it ion Ubuntu20.04 environment (Python3.8, Cuda11.6).

For installing, please follow these intructions.
```
conda create -n py38 python=3.8
conda activate py38
conda install pytorch=1.12 
pip install opencv-python tqdm tensorboardX ....
```
## Dataset
We sample the 2000 images from every desnowing dataset for the test stage, including CSD, SRRS and Snow100K. We provide the download link of datasets, and the password is **ephe**.

<table>
  <tr>
    <th align="left">Dataset</th>
    <th align="center">CSD</th>
    <th align="center">SRRS</th>
    <th align="center">Snow100K</th>
  </tr>
  <tr>
    <td align="left">Link</td>
    <td align="center"><a href="https://pan.baidu.com/s/133JxR-sCICZyIXAZSxS_GQ">Download</a></td>
    <td align="center"><a href="https://pan.baidu.com/s/1vTBmacVkwp6qtjofMC4-Qg">Download</a></td>
    <td align="center"><a href="https://pan.baidu.com/s/1TStTvd4GGF60HYTahvyxpA">Download</a></td>
  </tr>
 </table>

## Testing Stage
You can download pre-trained model of CSD from [Pre-trained model](https://pan.baidu.com/s/1zAUlrniCGgrONk0_8CBadw) &nbsp; **Password:ephe** and save it in model_path.

Run the following commands:
```python
python3  test.py --dataset_type CSD --dataset_CSD dataset_CSD --model_path model_path
```
The rusults are saved in ./out/dataset_type/

## TODO List
- [ ] Checkpoints of SRRS and Snow100K
- [ ] Train.py

## Citation 
```Bibtex
@article{chen2022snowformer,
  title={SnowFormer: Scale-aware Transformer via Context Interaction for Single Image Desnowing},
  author={Chen, Sixiang and Ye, Tian and Liu, Yun and Chen, Erkang and Shi, Jun and Zhou, Jingchun},
  journal={arXiv preprint arXiv:2208.09703},
  year={2022}
}
```
## Contact
If you have any questions, please contact the email 282542428@qq.com, ephemeral182@gmail.com or 201921114013@jmu.edu.cn.
